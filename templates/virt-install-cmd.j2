#!/bin/bash

virt-install --connect qemu:///system \
             --import \
             --name {{ vm_name }} \
             --ram {{ vm_memory }} \
             --vcpus {{vm_cpu}} \
             --disk {{ os_disk }},format=qcow2,bus=virtio,size={{ os_vm_disk_size }} \
             --disk {{ cloud_init_iso_image }},device=cdrom \
             --network {{ vm_virtinstall_net_opts }},mac={{ vm_mac }} \
             --os-type Linux \
             --os-variant {{ os_variant }} \
             --virt-type kvm \
             --noautoconsole \
{% for nic in extra_nics -%}
{% if nic.enable %}
             --network network={{ nic.libvirt_network }} \
{% endif %}
{% endfor -%}             
{% if enabled_nested is defined and enabled_nested is sameas true %}
             --cpu host \
{% endif -%}            
             --autostart

exit 0